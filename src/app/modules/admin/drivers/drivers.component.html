<!-- Driver List Container -->
<div class="min-h-screen bg-slate-950 text-white pb-6" (click)="closeMenu()">
  <div class="max-w-2xl mx-auto px-3 py-4 space-y-3">

    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-pink-500 rounded-xl py-3 px-5 shadow-lg flex items-center justify-between">
      <div>
        <h1 class="text-lg font-bold text-white">Driver Management</h1>
        <p class="text-purple-100 text-xs mt-0.5">Manage all drivers</p>
      </div>
      <button
        (click)="goToDashboard()"
        class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-md hover:shadow-lg transition flex-shrink-0"
        title="Close">
        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Compact Filters Section -->
    <div class="bg-slate-900 rounded-lg p-2.5 space-y-2 shadow border border-slate-800">

      <!-- Status Filter -->
      <div>
        <p class="text-xs font-semibold text-slate-300 mb-1.5">Status</p>
        <mat-chip-set aria-label="Status filter" class="flex flex-wrap gap-0.5">
          <mat-chip (click)="filterByStatus(null); $event.stopPropagation()" [highlighted]="selectedStatus === null" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            All
          </mat-chip>
          <mat-chip (click)="filterByStatus('online'); $event.stopPropagation()" [highlighted]="selectedStatus === 'online'" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            Online
          </mat-chip>
          <mat-chip (click)="filterByStatus('offline'); $event.stopPropagation()" [highlighted]="selectedStatus === 'offline'" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            Offline
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Cab Type Filter -->
      <div>
        <p class="text-xs font-semibold text-slate-300 mb-1.5">Cab Type</p>
        <mat-chip-set aria-label="Cab type filter" class="flex flex-wrap gap-0.5">
          <mat-chip (click)="filterByCabType(null); $event.stopPropagation()" [highlighted]="selectedCabType === null" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            All
          </mat-chip>
          <mat-chip (click)="filterByCabType('sedan'); $event.stopPropagation()" [highlighted]="selectedCabType === 'sedan'" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            Sedan
          </mat-chip>
          <mat-chip (click)="filterByCabType('hatchback'); $event.stopPropagation()" [highlighted]="selectedCabType === 'hatchback'" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            Hatchback
          </mat-chip>
          <mat-chip (click)="filterByCabType('suv'); $event.stopPropagation()" [highlighted]="selectedCabType === 'suv'" class="cursor-pointer text-xs py-0.5 px-1.5 h-auto">
            SUV
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading) {
      <div class="text-center py-6 text-slate-400">
        <svg class="w-8 h-8 animate-spin mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
          </path>
        </svg>
        <p class="text-xs">Loading drivers...</p>
      </div>
    } @else {
      @if ((filteredDrivers | async)?.length === 0) {
        <div class="text-center py-6 text-slate-400">
          <p class="text-xs">No drivers found</p>
        </div>
      } @else {

        <!-- Compact Contact List Style -->
        <div class="space-y-1.5">
          @for (driver of filteredDrivers | async; track driver.phone) {

            <div class="bg-slate-900 rounded-lg shadow border border-slate-800 hover:border-purple-500 transition group flex items-center justify-between px-3 py-2 relative" (click)="$event.stopPropagation()">

              <!-- Contact Info -->
              <div class="flex items-center gap-2.5 flex-1 min-w-0">
                <!-- Avatar with Status Indicator -->
                <div class="relative w-9 h-9 flex-shrink-0">
                  <div class="w-9 h-9 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center">
                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                  </div>
                  <!-- Status Indicator Dot -->
                  <div class="absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border border-slate-900" [ngClass]="driver.onlineStatus ? 'bg-green-500 animate-pulse' : 'bg-red-500'"></div>
                </div>

                <!-- Name & Phone -->
                <div class="min-w-0 flex-1">
                  <h3 class="font-semibold text-white text-sm truncate">{{ driver.name }}</h3>
                  <p class="text-xs text-slate-400 truncate">{{ driver.phone }}</p>
                </div>
              </div>

              <!-- 3-Dot Menu -->
              <div class="relative flex-shrink-0 ml-2">
                <button
                  (click)="toggleMenu(driver.phone); $event.stopPropagation()"
                  class="w-6 h-6 rounded-full flex items-center justify-center hover:bg-slate-700 transition">
                  <svg class="w-3.5 h-3.5 text-slate-300" fill="currentColor" viewBox="0 0 24 24">
                    <circle cx="12" cy="5" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="12" cy="19" r="2"></circle>
                  </svg>
                </button>

                @if (openMenu === driver.phone) {
                  <div class="absolute right-0 top-6 w-32 bg-slate-800 rounded-lg shadow-2xl border border-slate-700 z-50 overflow-hidden">
                    <button (click)="view(driver); openMenu=null" class="w-full text-left px-3 py-2 text-xs text-slate-200 hover:bg-purple-600/30 transition flex items-center gap-2">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                      </svg>
                      View
                    </button>
                    <button (click)="edit(driver); openMenu=null" class="w-full text-left px-3 py-2 text-xs text-slate-200 hover:bg-blue-600/30 transition flex items-center gap-2">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                      </svg>
                      Edit
                    </button>
                    <button (click)="delete(driver); openMenu=null" class="w-full text-left px-3 py-2 text-xs text-red-400 hover:bg-red-600/30 transition flex items-center gap-2 border-t border-slate-700">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                      Delete
                    </button>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    }
  </div>
</div>
